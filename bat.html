<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√∂kb√∂r√º, Arƒ± ve Yarasa Diskosu</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364); /* Gece G√∂ky√ºz√º */
            color: white;
            margin: 0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        /* --- UI KONTROLLER --- */
        .controls {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 32, 39, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid #00d2ff;
            box-shadow: 0 0 60px rgba(0, 210, 255, 0.3);
            z-index: 2000;
        }
        .controls.hidden { opacity: 0; pointer-events: none; transition: opacity 0.5s; }
        
        button {
            padding: 15px 40px;
            background: linear-gradient(90deg, #3a7bd5, #00d2ff);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
            transition: 0.3s;
        }
        button:hover { transform: scale(1.1); box-shadow: 0 0 30px rgba(58, 123, 213, 0.6); }

        .mute-control { position: absolute; top: 20px; right: 20px; z-index: 2000; }
        .btn-small { padding: 8px 15px; background: rgba(0,0,0,0.5); border: 1px solid #777; color: #fff; border-radius: 5px; cursor: pointer;}

        /* --- EFEKTLER (Bira ve AUUUU) --- */
        .float-text {
            position: fixed;
            font-weight: bold;
            pointer-events: none;
            z-index: 5000;
            text-shadow: 0 0 10px black;
            animation: floatUp 2s ease-out forwards;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 1; }
            50% { transform: translateY(-80px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-150px) scale(1); opacity: 0; }
        }

        /* --- DOLUNAY --- */
        .moon {
            position: fixed;
            top: 50px; right: 50px;
            width: 100px; height: 100px;
            background: #fdfcdc;
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(253, 252, 220, 0.5);
            z-index: 0;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        /* --- KARAKTERLER (Ortak) --- */
        .character-container {
            position: fixed;
            width: 120px; height: 120px;
            will-change: transform, left, top;
            transition: filter 0.2s;
            z-index: 10;
        }

        /* --- ARI üêù --- */
        .bee-body {
            width: 70px; height: 45px; background: #FFD700; border-radius: 35px;
            position: absolute; top: 35px; left: 25px;
            background-image: repeating-linear-gradient(90deg, transparent, transparent 12px, #000 12px, #000 24px);
        }
        .bee-wing {
            width: 40px; height: 25px; background: rgba(255, 255, 255, 0.8); border-radius: 50%;
            position: absolute; top: 10px;
        }
        .bee-wing.L { left: 25px; transform-origin: bottom right; }
        .bee-wing.R { left: 55px; transform-origin: bottom left; }
        .bee-eye {
            width: 10px; height: 10px; background: #000; border-radius: 50%; position: absolute; top: 45px; left: 80px; border: 2px solid white;
        }

        /* --- YARASA ü¶á --- */
        .bat-body {
            width: 50px; height: 60px; background: #333; border-radius: 25px; position: absolute; top: 30px; left: 35px;
        }
        .bat-wing {
            width: 80px; height: 50px; background: #111; position: absolute; top: 40px; clip-path: polygon(0 0, 100% 0, 50% 100%);
        }
        .bat-wing.L { left: -30px; transform-origin: right top; }
        .bat-wing.R { right: -30px; transform-origin: left top; }
        .bat-ear {
            position: absolute; width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 25px solid #333;
        }
        .bat-ear.L { left: 25px; transform: rotate(-20deg); top: 5px; }
        .bat-ear.R { right: 25px; transform: rotate(20deg); top: 5px; }
        .bat-eye {
            width: 8px; height: 8px; background: #00f2ff; border-radius: 50%; position: absolute; top: 45px;
        }
        .bat-eye.L { left: 45px; } .bat-eye.R { left: 65px; }


        /* --- BOZKURT üê∫ --- */
        /* CSS ile basit bir kurt kafasƒ±/g√∂vdesi √ßizimi */
        .wolf-body {
            width: 80px; height: 50px; background: #95a5a6; border-radius: 40px 50px 30px 40px;
            position: absolute; top: 40px; left: 20px;
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.3);
        }
        .wolf-head {
            width: 50px; height: 50px; background: #bdc3c7; border-radius: 50%;
            position: absolute; top: 20px; left: 60px;
            transform-origin: center bottom; /* Ulurken kafa yukarƒ± kalksƒ±n diye */
            transition: transform 0.1s;
        }
        .wolf-snout {
            width: 30px; height: 25px; background: #bdc3c7; border-radius: 15px;
            position: absolute; top: 25px; left: 30px; /* Kafanƒ±n i√ßinde */
        }
        .wolf-nose {
            width: 10px; height: 10px; background: #2c3e50; border-radius: 50%;
            position: absolute; top: 5px; right: -2px;
        }
        .wolf-ear {
            width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 20px solid #95a5a6;
            position: absolute; top: -10px;
        }
        .wolf-ear.L { left: 5px; transform: rotate(-15deg); }
        .wolf-ear.R { right: 5px; transform: rotate(15deg); }
        .wolf-eye {
            width: 8px; height: 8px; background: #f1c40f; border-radius: 50%;
            position: absolute; top: 20px; left: 30px;
            box-shadow: 0 0 5px #f1c40f;
        }

        /* --- EQUALIZER --- */
        .spectrum-container {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 120px;
            display: flex; align-items: flex-end; justify-content: space-around;
            pointer-events: none; opacity: 0.5; z-index: 1;
        }
        .bar { width: 1.5%; background: #fff; min-height: 5px; border-radius: 5px 5px 0 0; }

    </style>
</head>
<body>

    <div class="controls" id="controls">
        <h2>üê∫ G√∂kb√∂r√º & Disco üêù</h2>
        <p>Arƒ± (Bass) | Yarasa (Tiz) | Bozkurt (Vokal/Mid)</p>
        <button onclick="connectToTab()">BA≈ûLAT</button>
        <br><small style="color:#ccc">"Chrome Sekmesi" -> "Sesi Payla≈ü" se√ßilmeli.</small>
    </div>

    <div class="mute-control" id="muteDiv" style="display:none;">
        <button class="btn-small" id="muteBtn" onclick="toggleMute()">Sesi Kapat (Yankƒ± Varsa)</button>
    </div>

    <div class="moon" id="moon"></div>
    <div class="spectrum-container" id="spectrum"></div>

    <!-- ARI -->
    <div class="character-container" id="bee">
        <div class="bee-wing L" id="bwL"></div>
        <div class="bee-wing R" id="bwR"></div>
        <div class="bee-body"></div>
        <div class="bee-eye"></div>
    </div>

    <!-- YARASA -->
    <div class="character-container" id="bat">
        <div class="bat-ear L"></div>
        <div class="bat-ear R"></div>
        <div class="bat-wing L" id="btwL"></div>
        <div class="bat-wing R" id="btwR"></div>
        <div class="bat-body"></div>
        <div class="bat-eye L"></div>
        <div class="bat-eye R"></div>
    </div>

    <!-- BOZKURT -->
    <div class="character-container" id="wolf">
        <div class="wolf-body"></div>
        <div class="wolf-head" id="wolfHead">
            <div class="wolf-ear L"></div>
            <div class="wolf-ear R"></div>
            <div class="wolf-eye"></div>
            <div class="wolf-snout">
                <div class="wolf-nose"></div>
            </div>
        </div>
    </div>

    <script>
        // --- HAREKET DURUMLARI ---
        const beeState = { x: 100, y: 100, vx: 2, vy: 1.5, el: document.getElementById('bee') };
        const batState = { x: window.innerWidth - 200, y: 300, vx: -2, vy: -1.5, el: document.getElementById('bat') };
        // Kurt biraz daha yava≈ü ve aƒüƒ±r
        const wolfState = { x: window.innerWidth / 2, y: window.innerHeight - 200, vx: 1.5, vy: -1, el: document.getElementById('wolf') };
        
        let audioContext, analyser, dataArray, gainNode;
        let isRunning = false, isMuted = false;
        
        // √áarpƒ±≈üma Kontrol√º (Debounce s√ºresi)
        let lastCollisionTime = 0;
        const COLLISION_COOLDOWN = 1200; 

        // Equalizer √áubuklarƒ±
        const BAR_COUNT = 40;
        const spec = document.getElementById('spectrum');
        for(let i=0; i<BAR_COUNT; i++) {
            let b = document.createElement('div');
            b.className = 'bar'; b.id='bar'+i;
            spec.appendChild(b);
        }

        async function connectToTab() {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
                if (stream.getAudioTracks().length === 0) {
                    alert("L√ºtfen 'Sesi Payla≈ü' kutusunu i≈üaretleyin!"); return;
                }
                setupAudio(stream);
                document.getElementById('controls').classList.add('hidden');
                document.getElementById('muteDiv').style.display = 'block';
                stream.getVideoTracks()[0].onended = () => location.reload();
            } catch (err) { console.error(err); }
        }

        function setupAudio(stream) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            analyser.smoothingTimeConstant = 0.85; // Yumu≈üak ge√ßi≈üler
            analyser.fftSize = 256; 

            gainNode = audioContext.createGain();
            const source = audioContext.createMediaStreamSource(stream);
            
            source.connect(analyser);
            analyser.connect(gainNode);
            gainNode.connect(audioContext.destination);
            gainNode.gain.value = 1;

            dataArray = new Uint8Array(analyser.frequencyBinCount);
            isRunning = true;
            animate();
        }

        function toggleMute() {
            if(!gainNode) return;
            if(isMuted) { gainNode.gain.value = 1; isMuted = false; document.getElementById('muteBtn').innerText = "üîä Sesi Kapat (Yankƒ± Varsa)"; }
            else { gainNode.gain.value = 0; isMuted = true; document.getElementById('muteBtn').innerText = "üîá Sesi A√ß"; }
        }

        // --- METƒ∞N OLU≈ûTURMA FONKSƒ∞YONU ---
        function spawnText(x, y, text, fontSize, color) {
            const el = document.createElement('div');
            el.innerHTML = text;
            el.className = "float-text";
            el.style.left = x + "px";
            el.style.top = y + "px";
            el.style.fontSize = fontSize;
            el.style.color = color;
            document.body.appendChild(el);
            setTimeout(() => { el.remove(); }, 2000);
        }

        function animate() {
            if (!isRunning) return;
            requestAnimationFrame(animate);

            analyser.getByteFrequencyData(dataArray);

            // --- SES ANALƒ∞Zƒ∞ ---
            // Bass (0-5)
            let bass = 0; for(let i=0; i<5; i++) bass += dataArray[i]; bass /= 5;
            
            // Mids (6-15) - Kurt i√ßin (Vokaller/Gitar)
            let mids = 0; for(let i=6; i<15; i++) mids += dataArray[i]; mids /= 9;

            // Treble (20-50)
            let treble = 0; for(let i=20; i<50; i++) treble += dataArray[i]; treble /= 30;

            const now = Date.now();

            // --- 1. √áARPI≈ûMALAR ---
            checkCollisions(now);

            // --- 2. G√ñRSEL TEPKƒ∞LER ---

            // Dolunay (Genel sese tepki verir)
            const moonGlow = 20 + (bass + mids)/4;
            document.getElementById('moon').style.boxShadow = `0 0 ${moonGlow}px rgba(253, 252, 220, 0.6)`;
            document.getElementById('moon').style.transform = `scale(${1 + bass/800})`;

            // Arƒ± (Bass)
            const beeScale = 1 + (bass / 400); 
            beeState.el.style.transform = `scale(${beeScale}) scaleX(${beeState.vx > 0 ? 1 : -1})`;
            // Arƒ± Hƒ±zlanma
            const bwSpeed = 20 + bass/5;
            document.getElementById('bwL').style.transform = `rotate(${Math.sin(now/bwSpeed)*30}deg)`;
            document.getElementById('bwR').style.transform = `rotate(${Math.sin(now/bwSpeed)*-30}deg)`;

            // Yarasa (Treble)
            const batScale = 1 + (treble / 400);
            batState.el.style.transform = `scale(${batScale}) rotate(${Math.sin(now/200) * 10}deg)`;
            const btwSpeed = 30 - treble/10;
            const bflap = Math.sin(now/btwSpeed) * 30;
            document.getElementById('btwL').style.transform = `rotate(${10 + bflap}deg)`;
            document.getElementById('btwR').style.transform = `rotate(${-10 - bflap}deg)`;

            // BOZKURT (Mids - Uluma Hareketi)
            const wolfScale = 1 + (mids / 400);
            const wolfDir = wolfState.vx > 0 ? 1 : -1;
            // M√ºzik y√ºkselince (mid > 100) kafa yukarƒ± kalksƒ±n (uluma)
            const headTilt = mids > 120 ? -45 : 0; 
            
            document.getElementById('wolfHead').style.transform = `rotate(${headTilt}deg)`;
            wolfState.el.style.transform = `scale(${wolfScale}) scaleX(${wolfDir})`;
            
            // G√∂z Parlamasƒ± (Mid vurduƒüunda)
            const eyeColor = mids > 150 ? '#00d2ff' : '#f1c40f'; // Maviye d√∂ner
            document.querySelector('.wolf-eye').style.background = eyeColor;
            document.querySelector('.wolf-eye').style.boxShadow = `0 0 ${mids/10}px ${eyeColor}`;

            // Equalizer
            for(let i=0; i<BAR_COUNT; i++) {
                const h = dataArray[i] / 2;
                const bar = document.getElementById('bar'+i);
                bar.style.height = h + 'px';
                // Renk ge√ßi≈üi (Mavi tonlarƒ±)
                bar.style.background = `hsl(${180 + (h)}, 70%, 50%)`;
            }

            // --- 3. Fƒ∞Zƒ∞K ---
            updatePhysics(beeState);
            updatePhysics(batState);
            updatePhysics(wolfState);
        }

        function checkCollisions(now) {
            if (now - lastCollisionTime < COLLISION_COOLDOWN) return;

            // Merkez noktalarƒ±
            const bX = beeState.x + 60, bY = beeState.y + 60;
            const batX = batState.x + 60, batY = batState.y + 60;
            const wX = wolfState.x + 60, wY = wolfState.y + 60;

            const distBeeBat = Math.hypot(bX - batX, bY - batY);
            const distWolfBee = Math.hypot(wX - bX, wY - bY);
            const distWolfBat = Math.hypot(wX - batX, wY - batY);
            const limit = 90;

            let hit = false;

            // Arƒ± + Yarasa = Bira
            if (distBeeBat < limit) {
                spawnText((bX+batX)/2, (bY+batY)/2, "üç∫", "50px", "white");
                beeState.vx *= -1; batState.vx *= -1;
                hit = true;
            }
            // Kurt + Arƒ± = AUUUU
            else if (distWolfBee < limit) {
                spawnText((wX+bX)/2, (wY+bY)/2, "AUUUU üê∫", "40px", "#00d2ff");
                wolfState.vx *= -1; beeState.vx *= -1;
                hit = true;
            }
            // Kurt + Yarasa = AUUUU
            else if (distWolfBat < limit) {
                spawnText((wX+batX)/2, (wY+batY)/2, "AUUUU üê∫", "40px", "#00d2ff");
                wolfState.vx *= -1; batState.vx *= -1;
                hit = true;
            }

            if(hit) lastCollisionTime = now;
        }

        function updatePhysics(obj) {
            obj.x += obj.vx;
            obj.y += obj.vy;
            const pad = 120;
            
            // X Ekseni (Duvarlar)
            if (obj.x + pad > window.innerWidth) { obj.x = window.innerWidth - pad; obj.vx *= -1; }
            else if (obj.x < 0) { obj.x = 0; obj.vx *= -1; }

            // Y Ekseni (Duvarlar - Alttaki equalizer'a √ßarpmasƒ±n)
            if (obj.y + pad > window.innerHeight - 100) { obj.y = window.innerHeight - pad - 100; obj.vy *= -1; }
            else if (obj.y < 0) { obj.y = 0; obj.vy *= -1; }

            // Rastgele hafif s√ºz√ºlme deƒüi≈üikliƒüi
            if (Math.random() < 0.01) {
                obj.vx += (Math.random() - 0.5);
                obj.vy += (Math.random() - 0.5);
                // Hƒ±z sƒ±nƒ±rƒ±
                obj.vx = Math.max(-2.5, Math.min(2.5, obj.vx));
                obj.vy = Math.max(-2.5, Math.min(2.5, obj.vy));
            }
            
            obj.el.style.left = obj.x + 'px';
            obj.el.style.top = obj.y + 'px';
        }
    </script>
</body>
</html>