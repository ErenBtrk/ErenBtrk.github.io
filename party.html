<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Neon Disco</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #050505;
            color: white;
            margin: 0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        /* --- KONTROLLER --- */
        .controls {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 10, 20, 0.9);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid #00f2ff;
            box-shadow: 0 0 50px rgba(0, 242, 255, 0.2);
            z-index: 2000;
            backdrop-filter: blur(15px);
        }
        .controls.hidden { opacity: 0; pointer-events: none; transition: opacity 0.5s; }
        
        button {
            padding: 15px 40px;
            background: linear-gradient(90deg, #ff0055, #00f2ff);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
            transition: 0.3s;
        }
        button:hover { transform: scale(1.1); box-shadow: 0 0 30px rgba(255, 0, 85, 0.5); }

        .mute-control { position: absolute; top: 20px; right: 20px; z-index: 2000; }
        .btn-small { padding: 8px 15px; font-size: 0.85rem; background: #222; border: 1px solid #555; color: #fff; border-radius: 5px; cursor: pointer;}
        .btn-small.active { background: #ff0055; border-color: #ff0055; }

        /* --- KARAKTERLER --- */
        .character-container {
            position: fixed;
            width: 120px; height: 120px;
            will-change: transform, left, top;
            /* Glow efekti JS ile gÃ¼ncellenecek */
            transition: filter 0.1s; 
        }

        /* --- ARI --- */
        .bee-body {
            width: 80px; height: 50px;
            background: #FFD700;
            border-radius: 40px;
            position: absolute; top: 30px; left: 20px;
            background-image: repeating-linear-gradient(90deg, transparent, transparent 15px, #000 15px, #000 30px);
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.5);
            z-index: 2;
        }
        .bee-wing {
            width: 45px; height: 30px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            position: absolute; top: 5px;
            z-index: 1;
        }
        .bee-wing.L { left: 20px; transform-origin: bottom right; }
        .bee-wing.R { left: 55px; transform-origin: bottom left; }
        .bee-eye {
            width: 14px; height: 14px; background: #000; border-radius: 50%;
            position: absolute; top: 38px; left: 85px; border: 3px solid white; z-index: 3;
            transition: width 0.05s, height 0.05s; /* GÃ¶z bebeÄŸi efekti */
        }

        /* --- YARASA --- */
        .bat-body {
            width: 55px; height: 65px; background: #444; border-radius: 30px;
            position: absolute; top: 25px; left: 30px; z-index: 2;
        }
        .bat-wing {
            width: 90px; height: 55px; background: #222;
            position: absolute; top: 35px;
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            z-index: 1;
        }
        .bat-wing.L { left: -40px; transform-origin: right top; }
        .bat-wing.R { right: -40px; transform-origin: left top; }
        .bat-ear {
            position: absolute; top: 0px; width: 0; height: 0;
            border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 30px solid #444;
        }
        .bat-ear.L { left: 20px; transform: rotate(-20deg); }
        .bat-ear.R { right: 20px; transform: rotate(20deg); }
        .bat-eye {
            width: 10px; height: 10px; background: #00f2ff; border-radius: 50%;
            position: absolute; top: 40px; box-shadow: 0 0 10px #00f2ff; z-index: 3;
        }
        .bat-eye.L { left: 40px; } .bat-eye.R { left: 65px; }

        /* --- EQUALIZER (SPEKTRUM) --- */
        .spectrum-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            pointer-events: none;
            z-index: 0;
            opacity: 0.8;
            padding: 0 20px;
            box-sizing: border-box;
        }
        .bar {
            width: 2%; /* GeniÅŸlik */
            background: linear-gradient(to top, #00f2ff, #ff0055);
            border-radius: 10px 10px 0 0;
            min-height: 5px;
            transition: height 0.05s ease;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.5);
        }

        /* --- ARKA PLAN YILDIZLARI --- */
        .stars {
            position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1;
        }
        .star {
            position: absolute; background: white; border-radius: 50%;
            transition: transform 0.1s, opacity 0.1s;
        }

    </style>
</head>
<body>

    <div class="controls" id="controls">
        <h2>ðŸŽ§ Neon GÃ¶rselleÅŸtirici ðŸŽ§</h2>
        <p>Daha yavaÅŸ uÃ§uÅŸ, daha fazla renk ve tepki.</p>
        <button onclick="connectToTab()">BAÅžLAT</button>
        <br>
        <small style="color:#aaa;">"Chrome Sekmesi" -> "Sesi PaylaÅŸ" seÃ§meyi unutma.</small>
    </div>

    <div class="mute-control" id="muteDiv" style="display:none;">
        <button class="btn-small" id="muteBtn" onclick="toggleMute()">Sesi Kapat (YankÄ±)</button>
    </div>

    <!-- EQUALIZER DUVARI -->
    <div class="spectrum-container" id="spectrum"></div>

    <!-- ARKA PLAN YILDIZLARI -->
    <div class="stars" id="starField"></div>

    <!-- ARI -->
    <div class="character-container" id="bee">
        <div class="bee-wing L" id="bwL"></div>
        <div class="bee-wing R" id="bwR"></div>
        <div class="bee-body" id="beeBody"></div>
        <div class="bee-eye" id="beeEye"></div>
    </div>

    <!-- YARASA -->
    <div class="character-container" id="bat">
        <div class="bat-ear L"></div>
        <div class="bat-ear R"></div>
        <div class="bat-wing L" id="btwL"></div>
        <div class="bat-wing R" id="btwR"></div>
        <div class="bat-body" id="batBody"></div>
        <div class="bat-eye L" id="beL"></div>
        <div class="bat-eye R" id="beR"></div>
    </div>

    <script>
        // HIZ AYARLARI (YavaÅŸlatÄ±ldÄ±)
        // vx ve vy deÄŸerlerini dÃ¼ÅŸÃ¼rerek uÃ§uÅŸu sakinleÅŸtirdik.
        const beeState = { x: 100, y: 100, vx: 1.5, vy: 1 };
        const batState = { x: window.innerWidth - 200, y: 300, vx: -1.5, vy: -1.2 };
        
        let audioContext, analyser, dataArray, gainNode;
        let isRunning = false, isMuted = false;
        
        // Equalizer Ã‡ubuk SayÄ±sÄ±
        const BAR_COUNT = 32; 

        // BaÅŸlangÄ±Ã§ta Equalizer ve YÄ±ldÄ±zlarÄ± oluÅŸtur
        initEnvironment();

        function initEnvironment() {
            // Ã‡ubuklarÄ± oluÅŸtur
            const spec = document.getElementById('spectrum');
            for(let i=0; i<BAR_COUNT; i++) {
                let bar = document.createElement('div');
                bar.className = 'bar';
                bar.id = 'bar'+i;
                spec.appendChild(bar);
            }

            // YÄ±ldÄ±zlarÄ± oluÅŸtur
            const field = document.getElementById('starField');
            for(let i=0; i<50; i++) {
                let s = document.createElement('div');
                s.className = 'star';
                s.style.left = Math.random() * 100 + 'vw';
                s.style.top = Math.random() * 100 + 'vh';
                s.style.width = Math.random() * 3 + 'px';
                s.style.height = s.style.width;
                s.id = 'star'+i;
                field.appendChild(s);
            }
        }

        async function connectToTab() {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
                if (stream.getAudioTracks().length === 0) {
                    alert("Ses bulunamadÄ±! 'Sesi PaylaÅŸ' kutusunu iÅŸaretleyin."); return;
                }
                setupAudio(stream);
                document.getElementById('controls').classList.add('hidden');
                document.getElementById('muteDiv').style.display = 'block';
                stream.getVideoTracks()[0].onended = () => location.reload();
            } catch (err) { console.error(err); }
        }

        function setupAudio(stream) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            gainNode = audioContext.createGain();
            const source = audioContext.createMediaStreamSource(stream);
            
            source.connect(analyser);
            analyser.connect(gainNode);
            gainNode.connect(audioContext.destination);
            gainNode.gain.value = 1;

            analyser.fftSize = 128; // Daha detaylÄ± veri iÃ§in
            dataArray = new Uint8Array(analyser.frequencyBinCount);

            isRunning = true;
            animate();
        }

        function toggleMute() {
            if(!gainNode) return;
            const btn = document.getElementById('muteBtn');
            if(isMuted) {
                gainNode.gain.value = 1; isMuted = false;
                btn.innerText = "Sesi Kapat (YankÄ±)"; btn.classList.remove('active');
            } else {
                gainNode.gain.value = 0; isMuted = true;
                btn.innerText = "Sesi AÃ§"; btn.classList.add('active');
            }
        }

        function animate() {
            if (!isRunning) return;
            requestAnimationFrame(animate);

            analyser.getByteFrequencyData(dataArray);

            // --- VERÄ° ANALÄ°ZÄ° ---
            // Bass (DÃ¼ÅŸÃ¼k Frekanslar)
            let bass = 0; 
            for(let i=0; i<5; i++) bass += dataArray[i];
            bass = bass / 5; // 0-255

            // Treble (YÃ¼ksek Frekanslar)
            let treble = 0;
            for(let i=20; i<40; i++) treble += dataArray[i];
            treble = treble / 20; // 0-255

            const now = Date.now();

            // --- 1. EQUALIZER GÃ–RSELLÄ°ÄžÄ° ---
            for(let i=0; i<BAR_COUNT; i++) {
                const val = dataArray[i];
                const bar = document.getElementById('bar'+i);
                // Ã‡ubuk yÃ¼ksekliÄŸi
                bar.style.height = Math.max(5, val * 1.5) + 'px';
                // Ã‡ubuk rengi (Bass vurduÄŸunda parlar)
                bar.style.filter = `hue-rotate(${bass}deg)`;
            }

            // --- 2. YILDIZLARIN TÄ°TREMESÄ° ---
            // Kick vurduÄŸunda (Bass > 200) yÄ±ldÄ±zlar bÃ¼yÃ¼r
            const starScale = 1 + (bass > 180 ? 1 : 0);
            const starOpacity = 0.3 + (treble / 400);
            document.getElementById('starField').style.opacity = starOpacity;
            // BazÄ± yÄ±ldÄ±zlarÄ± rastgele parlat
            if(bass > 150) {
                const randomStar = document.getElementById('star' + Math.floor(Math.random()*50));
                if(randomStar) randomStar.style.transform = `scale(${2 + Math.random() * 3})`;
            }

            // --- 3. KARAKTER ANÄ°MASYONLARI ---
            
            // Kanat HÄ±zÄ± (Manuel DÃ¶ngÃ¼)
            // ArÄ± KanadÄ±
            const beeWingAngle = Math.sin(now / (100 - bass/3)) * 40; // Bass arttÄ±kÃ§a hÄ±zlanÄ±r
            document.getElementById('bwL').style.transform = `rotate(${beeWingAngle}deg)`;
            document.getElementById('bwR').style.transform = `rotate(${-beeWingAngle}deg)`;

            // Yarasa KanadÄ±
            const batWingAngle = Math.sin(now / (150 - treble/2)) * 30;
            document.getElementById('btwL').style.transform = `rotate(${10 + batWingAngle}deg)`;
            document.getElementById('btwR').style.transform = `rotate(${-10 - batWingAngle}deg)`;

            // GÃ¶z BebeÄŸi BÃ¼yÃ¼mesi (Eye Dilation)
            const eyeSize = 14 + (bass / 30);
            document.getElementById('beeEye').style.width = eyeSize + 'px';
            document.getElementById('beeEye').style.height = eyeSize + 'px';


            // --- 4. HAREKET VE RENK DEÄžÄ°ÅžÄ°MÄ° ---
            
            // ArÄ± (Bass'a tepki verir)
            // Renk DeÄŸiÅŸimi: Normalde sarÄ±, Bass vurduÄŸunda Turuncu/KÄ±rmÄ±zÄ±
            const beeHue = -bass / 2; // SarÄ±dan kÄ±rmÄ±zÄ±ya kayar
            const beeGlow = `drop-shadow(0 0 ${bass/5}px orange) hue-rotate(${beeHue}deg)`;
            
            const beeEl = document.getElementById('bee');
            updatePhysics(beeState, 1 + (bass/200)); // HÄ±z Ã§arpanÄ± dÃ¼ÅŸÃ¼k
            beeEl.style.left = beeState.x + 'px';
            beeEl.style.top = beeState.y + 'px';
            // ArÄ± Bass ile zÄ±plar (Scale)
            beeEl.style.transform = `scale(${1 + bass/400}) scaleX(${beeState.vx > 0 ? 1 : -1})`;
            beeEl.style.filter = beeGlow;

            // Yarasa (Treble'a tepki verir)
            // Renk DeÄŸiÅŸimi: Normalde gri, Tizlerde Mor/Cyan
            const batHue = treble; 
            const batGlow = `drop-shadow(0 0 ${treble/5}px cyan) hue-rotate(${batHue}deg)`;

            const batEl = document.getElementById('bat');
            updatePhysics(batState, 1 + (treble/200));
            batEl.style.left = batState.x + 'px';
            batEl.style.top = batState.y + 'px';
            // Yarasa Tizlerde titrer
            const shake = (treble/10) * Math.sin(now/50);
            batEl.style.transform = `rotate(${shake}deg) scale(${1 + treble/400})`;
            batEl.style.filter = batGlow;
        }

        function updatePhysics(obj, speedBoost) {
            // HÄ±z limiti koyuyoruz (En fazla 2 kat hÄ±zlansÄ±nlar)
            const s = Math.min(speedBoost, 2.0);
            
            obj.x += obj.vx * s;
            obj.y += obj.vy * s;
            const pad = 120;
            const w = window.innerWidth;
            const h = window.innerHeight;

            // Duvarlara Ã§arpma
            if (obj.x + pad > w) { obj.x = w - pad; obj.vx *= -1; }
            else if (obj.x < 0) { obj.x = 0; obj.vx *= -1; }

            if (obj.y + pad > h - 100) { obj.y = h - pad - 100; obj.vy *= -1; } // Equalizer'a Ã§arpmasÄ±n
            else if (obj.y < 0) { obj.y = 0; obj.vy *= -1; }

            // Organik sÃ¼zÃ¼lme (Ã‡ok hafif rastgelelik)
            if (Math.random() < 0.02) {
                obj.vx += (Math.random() - 0.5) * 0.5;
                obj.vy += (Math.random() - 0.5) * 0.5;
                // Maksimum hÄ±z sÄ±nÄ±rÄ± (Ã‡ok hÄ±zlanmasÄ±nlar)
                const maxSpeed = 3;
                obj.vx = Math.max(-maxSpeed, Math.min(maxSpeed, obj.vx));
                obj.vy = Math.max(-maxSpeed, Math.min(maxSpeed, obj.vy));
            }
        }
    </script>
</body>
</html>